# Detection Coverage Analysis Guide

## Understanding Your Analysis Results

This guide explains how to interpret the `rule_comparison_report.html` report generated by `customer_audit_v4.py`.

---

## âš ï¸ IMPORTANT: Data Freshness Context

Your analysis results reflect:
- **Rules as of:** Today's export
- **Detections as of:** Today's export  
- **Events as of:** Today's export

Results change because your environment changes daily. This is **NORMAL and EXPECTED**.

If results differ from previous months:
- âœ… Rules were added or deleted
- âœ… Rules were enabled or disabled
- âœ… New event types appeared
- âœ… Detection patterns changed

**Always interpret results in context of today's data.**

---

## Report Sections Explained

### Section 1: Summary Statistics

**What it shows:**
- Total rules in your system
- Enabled vs disabled rules
- Rules actively triggering
- Overall detection coverage percentage
- Unmapped events (detection gaps)

**How to read it:**

```
Total Rules: 342
â”œâ”€ This is your complete rule inventory
â”œâ”€ Includes enabled AND disabled rules
â””â”€ Represents your detection capability library

Enabled Rules: 325 (95%)
â”œâ”€ Rules that are actively monitoring
â”œâ”€ Should be majority of your rules
â””â”€ Disabled rules (17) are archived/paused

Rules Triggering: 245 (75%)
â”œâ”€ Rules generating actual detections
â”œâ”€ Healthy = 70%+ of enabled rules triggering
â”œâ”€ Below 50% = potential coverage issue
â””â”€ Indicates active threat detection

Event Coverage: 57.6%
â”œâ”€ Percentage of events being detected
â”œâ”€ Higher is better (80%+ is excellent)
â”œâ”€ 50-80% is moderate coverage
â””â”€ Below 50% indicates gaps to address

Unmapped Events: 70
â”œâ”€ Events in your environment NOT detected
â”œâ”€ Represents security gaps
â”œâ”€ Prioritize by risk/severity
â””â”€ Plan new rules for critical gaps
```

---

### Section 2: Rules by State

**What it shows:**
- How many rules are ENABLED vs DISABLED
- Percentage distribution
- Visual breakdown

**How to interpret:**

**Healthy Distribution:**
```
ENABLED:  90%+ 
DISABLED: <10%

Interpretation: Most rules are active
Action: Good! Few dormant rules
```

**Warning Distribution:**
```
ENABLED:  <70%
DISABLED: >30%

Interpretation: Many disabled rules
Action: Investigate why so many are disabled
       - Are they archived?
       - Are they causing false positives?
       - Should they be re-enabled?
```

**What to do:**
1. Note the percentages
2. If >30% disabled, investigate why
3. Contact rules administrator if unclear
4. Re-enable critical disabled rules

---

### Section 3: Rules by Severity

**What it shows:**
- Distribution of rule severity levels
- CRITICAL, HIGH, MEDIUM, LOW breakdown
- Which severity levels are covered

**How to interpret:**

```
CRITICAL: 8 rules (2%)
  â””â”€ Highest priority threats
  
HIGH: 89 rules (26%)
  â””â”€ Important threats
  
MEDIUM: 156 rules (46%)
  â””â”€ Moderate threats
  
LOW: 97 rules (28%)
  â””â”€ Lower priority threats
```

**Healthy Distribution:**
- Good coverage across severity levels
- More rules for higher severity threats
- Covers CRITICAL and HIGH threats

**Warning Signs:**
```
âŒ No CRITICAL rules at all
   Action: Add critical threat detection

âŒ All rules are LOW severity
   Action: Add rules for higher-severity threats

âŒ CRITICAL rules are disabled
   Action: IMMEDIATELY enable critical rules
```

**What to do:**
1. Review CRITICAL and HIGH rule counts
2. Verify critical rules are ENABLED
3. Ensure CRITICAL threats are covered
4. Plan to add rules for any missing severity levels

---

### Section 4: Rules Not Triggering

**What it shows:**
- Enabled rules that have NOT generated detections
- Potential problem rules
- Rules that need investigation

**Why this matters:**

Rules not triggering can indicate:
- âœ“ Legitimate - threat type doesn't occur in your environment
- âŒ Misconfigured - rule logic is wrong
- âŒ Inactive - log source isn't providing data
- âŒ Wrong threshold - too strict, missing real events
- âŒ Deprecated - rule targets old/obsolete threats

**How to interpret:**

```
Example: "Failed_Login_Detection" hasn't triggered

Could be:
âœ“ GOOD: Users aren't having failed login attempts
âŒ BAD: Rule misconfigured, not catching failures
âŒ BAD: Windows event logs aren't being collected
âŒ BAD: Threshold too high (requires 100+ failures, reality is 50)
```

**What to do for each rule not triggering:**

1. **Check rule configuration**
   - Verify logic is correct
   - Check thresholds
   - Ensure condition makes sense

2. **Verify data sources**
   - Is the log source collecting data?
   - Are events occurring?
   - Check log volume in report

3. **Check rule status**
   - Is rule actually enabled?
   - Any date restrictions?
   - Any scope limitations?

4. **Research threat occurrence**
   - Does this threat occur in your environment?
   - If not, may be legitimately unnecessary
   - If yes, rule needs investigation/fix

**Action Priority:**
- ğŸ”´ CRITICAL rules not triggering: Investigate immediately
- ğŸŸ  HIGH rules not triggering: Investigate this week
- ğŸŸ¡ MEDIUM rules not triggering: Review and assess
- ğŸŸ¢ LOW rules not triggering: May be acceptable

---

### Section 5: Log Types by Volume

**What it shows:**
- Which log types generate the most data
- Weekly event counts
- Volume in gigabytes
- Data distribution across log sources

**How to interpret:**

```
WINEVTLOG: 1,245,000 events/week, 48.92 GB
â””â”€ Windows Events - largest data source
â””â”€ Deserves high detection investment

OFFICE365: 542,100 events/week, 22.15 GB
â””â”€ Office 365 - significant volume
â””â”€ Should have good detection coverage

FORTINET_FIREWALL: 823,500 events/week, 35.67 GB
â””â”€ Firewall logs - substantial volume
â””â”€ Needs detection rules for threats

LOW_VOLUME_SOURCE: 1,200 events/week, 0.05 GB
â””â”€ Minimal data
â””â”€ Lower priority for detection
```

**What to do:**

1. **Identify highest volume sources**
   - These deserve most detection resources
   - Plan coverage for top 3-5 sources

2. **Verify detection coverage**
   - High volume sources should have good rule coverage
   - Check unmapped events from these sources
   - Plan rules for gaps

3. **Assess resource allocation**
   - Are you detecting from highest-volume sources?
   - Should you reduce focus on low-volume sources?
   - Plan rule development accordingly

4. **Trending (if comparing multiple months)**
   - New log sources appearing?
   - Volumes increasing/decreasing?
   - Plan for growth

---

### Section 6: Unmapped Events (Detection Gaps)

**What it shows:**
- Events in your environment with NO detection rule
- Security detection gaps
- Prioritized list of what's not being detected

**Critical to understand:**

Unmapped events represent a security gap:
- These events are happening
- No rule is detecting them
- You're not seeing these security indicators

**How to interpret:**

```
Example unmapped events from WINEVTLOG:

4625 - Failed Login Attempts
  â””â”€ Risk: HIGH
  â””â”€ Status: Unmapped (NOT detected)
  â””â”€ Action: Create rule ASAP

4688 - Process Creation
  â””â”€ Risk: MEDIUM
  â””â”€ Status: Unmapped
  â””â”€ Action: Create rule

1102 - Event Log Cleared
  â””â”€ Risk: CRITICAL
  â””â”€ Status: Unmapped
  â””â”€ Action: CRITICAL - Create immediately!
```

**Risk Assessment:**

ğŸ”´ **CRITICAL - Immediate Action Required:**
- Failed login attempts (4625)
- Privilege escalation events (4648, 4672)
- Account modifications (4720-4728)
- Service installation (7045)
- Deletion/modification events
- Security log clearing (1102)

ğŸŸ  **HIGH - Important Gaps:**
- Suspicious process behavior
- Unusual network connections
- Office 365 anomalies
- File access violations
- Account lockouts

ğŸŸ¡ **MEDIUM - Should Plan:**
- Routine log events from new sources
- Process events (unless correlating with others)
- Standard application events

ğŸŸ¢ **LOW - May Be Acceptable:**
- Informational events
- Routine operations
- Normal application activity

**What to do:**

1. **Review critical unmapped events**
   - Identify high-risk events without detection
   - Assign priority based on threat

2. **Plan rule creation**
   - Prioritize gaps covering critical threats
   - Work through HIGH and MEDIUM severity gaps
   - Document reasoning for LOW/acceptable gaps

3. **Track remediation**
   - Create rules for critical gaps
   - Test new rules
   - Re-run analysis to verify coverage improvement

4. **Document gaps**
   - For gaps you accept as non-critical:
   - Document WHY they're not detected
   - Justification for stakeholders
   - Risk acceptance sign-off

---

## Practical Examples

### Example 1: Good Coverage

```
Total Rules: 500
Enabled: 450 (90%) âœ“
Triggering: 380 (84%) âœ“
Coverage: 82% âœ“
Unmapped: 18 events (mostly low-risk) âœ“

CRITICAL Rules:
- All enabled âœ“
- All triggering âœ“

Interpretation:
âœ… Healthy detection posture
âœ… Good rule coverage
âœ… Gaps are acceptable (low-risk events)
âœ… Continue current practices

Action:
- Maintain current rules
- Monitor for changes
- Track trending
```

### Example 2: Concerning Coverage

```
Total Rules: 342
Enabled: 200 (58%) âŒ
Triggering: 100 (50%) âŒ
Coverage: 45% âŒ
Unmapped: 89 events (many CRITICAL) âŒ

CRITICAL Rules:
- 50% are disabled âŒ
- Only 30% triggering âŒ

Interpretation:
âŒ Significant coverage gaps
âŒ Too many disabled rules
âŒ Low detection coverage
âŒ Multiple CRITICAL threats unmapped

Action:
1. IMMEDIATELY: Enable all CRITICAL rules
2. THIS WEEK: Investigate why 58% of rules disabled
3. Create rules for unmapped CRITICAL events
4. Assess resource constraints
5. Plan improvement initiative
```

### Example 3: Improving Coverage

```
Month 1 (January):
- Rules: 342
- Triggering: 245 (72%)
- Coverage: 57.6%
- Unmapped: 70

Month 2 (February):
- Rules: 355 (13 NEW rules!) âœ“
- Triggering: 268 (75%) âœ“
- Coverage: 68% âœ“
- Unmapped: 52 (18 fewer gaps) âœ“

Interpretation:
âœ… Improvement tracked
âœ… New rules created and working
âœ… Coverage increased
âœ… Gaps being addressed

Action:
- Continue current trajectory
- Keep monthly analysis going
- Plan to reach 80%+ coverage
```

---

## Risk-Based Prioritization

### Tier 1 - Address Immediately (This Week)

High-risk events that are UNMAPPED:
- âŒ Privilege escalation (4672, 4648)
- âŒ Account modifications (4720-4728)
- âŒ Failed logins (4625) - if high volume
- âŒ Event log clearing (1102)
- âŒ Service installation (7045)
- âŒ Unauthorized access attempts

**Action:** Create detection rules ASAP

### Tier 2 - Address Soon (This Month)

Medium-risk unmapped events:
- ğŸŸ¡ Suspicious process behavior
- ğŸŸ¡ Unusual network activity
- ğŸŸ¡ Office 365 suspicious activity
- ğŸŸ¡ File access violations

**Action:** Plan and implement rules

### Tier 3 - Track (Next Quarter)

Low-risk or informational events:
- ğŸŸ¢ Routine operations
- ğŸŸ¢ Standard application events
- ğŸŸ¢ Process monitoring (if not correlating)

**Action:** Document and plan as time permits

### Tier 4 - Accept (Documented)

Events with acceptable risk:
- ğŸ“‹ Determined not a security concern
- ğŸ“‹ Resource constraints prevent detection
- ğŸ“‹ False positive risk is too high

**Action:** Document decision and rationale

---

## Trending & Improvement

### Track Over Time

Run analysis monthly to track:
- âœ… Rule count growth (adding new rules?)
- âœ… Detection coverage improvement (%) 
- âœ… Unmapped event reduction (gaps closing?)
- âœ… Rules not triggering (improving dormant rules?)

**Example trend:**

```
Jan: 342 rules, 57.6% coverage, 70 unmapped
Feb: 355 rules, 68% coverage, 52 unmapped âœ“
Mar: 368 rules, 75% coverage, 35 unmapped âœ“
Apr: 380 rules, 82% coverage, 18 unmapped âœ“
May: Goal 90%+ coverage

Track shows:
- Consistent improvement âœ“
- Rules being added âœ“
- Gaps being addressed âœ“
```

### Metrics to Track

| Metric | Current | Target | Trend |
|--------|---------|--------|-------|
| Total Rules | 342 | Maintain | Growing |
| Enabled % | 95% | 95%+ | Stable |
| Triggering % | 72% | 80%+ | Improving |
| Coverage % | 57.6% | 80%+ | Improving |
| Unmapped Events | 70 | <20 | Decreasing |

---

## Questions to Answer

After reviewing your report, answer:

1. **Rule Health**
   - [ ] Are most rules enabled? (Should be 90%+)
   - [ ] Are most rules triggering? (Should be 70%+)
   - [ ] Are CRITICAL rules enabled? (Must be 100%)

2. **Coverage**
   - [ ] What's your current coverage percentage?
   - [ ] Is this acceptable for your organization?
   - [ ] What's your target coverage?

3. **Gaps**
   - [ ] Are critical threats unmapped?
   - [ ] Are high-risk events undetected?
   - [ ] What's your gap remediation plan?

4. **Data**
   - [ ] Are high-volume log types well covered?
   - [ ] Do you have rules for top 3-5 log sources?
   - [ ] Are new log sources appearing?

5. **Action Items**
   - [ ] What rules need fixing?
   - [ ] What rules need creating?
   - [ ] What rules should be reviewed?
   - [ ] What's the timeline?

---

## Common Interpretations

### "Many rules enabled but not triggering"

**Causes:**
- Threat type doesn't occur in environment
- Misconfigured rules
- Log source not collecting
- Thresholds too strict

**Assessment:**
- If from expected threats: Problem!
- If from rare/unlikely threats: OK
- Investigate CRITICAL/HIGH rules especially

**Action:**
- Review each non-triggering rule
- Verify configuration is correct
- Check data source is working
- Adjust thresholds if too strict

---

### "High coverage but still many unmapped events"

**Interpretation:**
- You're detecting well for covered types
- But missing some event types completely

**Assessment:**
- Normal - few environments detect everything
- Look at severity of unmapped events
- Prioritize critical unmapped events

**Action:**
- Review unmapped event risks
- Create rules for critical gaps
- Accept lower-risk gaps if necessary

---

### "Low coverage with few unmapped events"

**Interpretation:**
- Few rules created yet
- Environment has few event types overall

**Assessment:**
- Early stage environment
- May have limited variety of events
- Or small environment

**Action:**
- Create core detection rules
- Focus on CRITICAL threats first
- Build coverage incrementally

---

## Tips for Better Analysis

1. **Compare to previous months**
   - Track improvement over time
   - Shows effectiveness of efforts

2. **Focus on critical threats**
   - High-risk events need coverage
   - Low-risk gaps may be acceptable

3. **Investigate non-triggering rules**
   - Especially CRITICAL/HIGH severity
   - May indicate configuration issues

4. **Leverage log volume data**
   - High-volume sources deserve focus
   - Allocate resources accordingly

5. **Document decisions**
   - Why you're accepting gaps
   - Why unmapped events don't need rules
   - Creates audit trail

---

## Next Steps

1. **Review this report thoroughly**
   - Understand your current coverage
   - Identify critical gaps

2. **Create action plan**
   - Prioritize rule creation/fixes
   - Assign responsibilities
   - Set timelines

3. **Communicate findings**
   - Share with stakeholders
   - Discuss coverage targets
   - Plan improvement

4. **Take action**
   - Fix misconfigured rules
   - Create rules for critical gaps
   - Enable disabled critical rules

5. **Track progress**
   - Run analysis monthly
   - Monitor improvement
   - Celebrate gains

---

## Related Documents

- **HOW_TO_USE_SCRIPT.md** - How to run the analysis
- **STEP_BY_STEP_GUIDE.md** - Step-by-step walkthrough
- **DOWNLOAD_AND_PREPARE_FILES.md** - Getting data ready

---

**Remember: Each month's analysis shows TODAY's state. Results change as rules, events, and detections change. This is normal and expected!**
